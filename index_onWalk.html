<!DOCTYPE html>
<html>
    <head>
        <title>Walk With Talk</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
        <link rel="stylesheet" href="assets/css/style.css">
        <link href='http://fonts.googleapis.com/css?family=Lato:100,300,400,700' rel='stylesheet' type='text/css'>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js">
        </script>
        <script src = "assets/js/script.js"></script>
        <script type="text/javascript">
        $(document).ready(function() {

            var set_time = function(m, s) {
                if (m <= 9)
                    m = "0"+m;

                if (s <= 9)
                    s = "0" + (s+1);

                $("#map_time-min").text(m);
                $("#map_time-sec").text(s);
            };

        $("#start-walking-button").on("click", function() {
            var anim = function() {
                function Vector2(x, y) {
                    this.x = x;
                    this.y = y;
                };

                ROUTE = [
                    new Vector2(250, 404),
                    new Vector2(198, 107),
                    new Vector2(15,  136),
                    new Vector2(49,  336),
                    new Vector2(232, 305),
                    new Vector2(250, 404)
                ];

                SLOPE = function(a, b) {
                    var m = (b.y - a.y) / (b.x - a.x);
                    var i = 0;
                    if (m > 1 && m < 1) {
                        while (m < 1) m *= 2;
                    } else if (m < 0 && m < -1) {
                        while (m < -1) m *= 2;
                    }
                    return m;
                }

                $("#walk_editable-screen").show("slow");

                var img = document.getElementById("map-image");
                var c = document.getElementById("cvas");
                var context = c.getContext("2d");

                context.drawImage(img, 0, 0);
                context.strokeStyle = "blue";

                var idx = 1;
                var pos = ROUTE[0];
                var end = ROUTE[1];
                var m = SLOPE(pos, end);
                var s = setInterval(function() {
                    var seconds = parseInt($("#map_time-sec").text());
                    var minutes = parseInt($("#map_time-min").text());

                    if (seconds + 1 >= 60)
                        minutes += 1;
                    else
                        seconds += 1;

                    set_time(minutes, seconds);
                }, 1000);

                var d = setInterval(function() {
                    var t = $("#map-dist-mi").text();
                    var n = parseFloat(t);
                    $("#map-dist-mi").text((n+0.01).toFixed(2));
                }, 750);

                var i = setInterval(function() {
                    if (idx >= ROUTE.length)
                    {
                        clearInterval(i);
                        clearInterval(s);
                        return;
                    } else {
                        context.rect(pos.x, pos.y, 2, 2);
                        context.stroke();
                        pos.y -= m;
                        pos.x -= 1;

                        if (pos.x == end.x && parseInt(pos.y) == end.y)
                        {
                            idx += 1;
                            pos = end;
                            end = ROUTE[idx];
                            m = SLOPE(pos, end);
                        }
                    }
                }, 100);

                $("#end-button").on("click", function() {
                    clearInterval(i);
                    clearInterval(s);
                    clearInterval(d);
                    set_time(0, 30);
                    $("#map-dist-mi").text("0.00");
                });
            };
            anim();
        });
        });
        </script>
    </head>


    <body>

        <div id="phone-container">
            <img src="assets/img/Nexus5.png">

            <div id="screen-container">
                <div id="status-bar"><img src="assets/img/StatusBar.png"></div>

                <!-- We need to keep the JS consistent, so don't forget to
                     change the IDs on the container as well. -->
                <div class="screen" id="walk_editable-screen">

                    <div class="before-start" id="before-start-cover">
                        <div class="button" id="start-walking-button">
                            <div id="start-walking-text">START WALKING</div>
                        </div>
                        <div class="button" id="find-buddy-button">
                            <div id="find-buddy-text">FIND A BUDDY</div>
                        </div>
                    </div>

                    <div id="map_info">
                        <div id="map_time">
                            <span id="map_time-hr">0</span>:<span id="map_time-min">00</span>:<span id="map_time-sec">30</span>
                        </div>
                        <div class="button" id="map_camera-box">
                            <img src ="assets/img/Camera.png">
                            <!-- Icon made by [author link] from www.flaticon.com  -->
                        </div>
                        <div id="map_dist">
                            <span id="map-dist-mi">0.1</span>
                            mi
                        </div>
                    </div>

                    <div id="map_map-box">
                        <canvas id="cvas" width="363" height="573">
                        <img id="map-image" src="assets/img/Map.png"
                             style="display: none;">
                    </div>

                    <div class="button" id="end-button">
                        <p id="end-button-text"> End Walk </p>
                    </div>
                </div>

                <div id="nav-bar">
                    <a href="index.html" class="button" id="back-button"><img src="assets/img/BackArrow.png"></a>
                    <a href="index_onWalk.html" class="button" id="home-button"><img src="assets/img/House.png"></a>
                    <a href="index_chat.html" class="button" id="chat-button"><img src="assets/img/Chat.png"></a>
                    <div class="button" id="stats-button"><img src="assets/img/Stats.png"></div>
                </div>

            </div>




            </div>

        </div>
    </body>
</html>
